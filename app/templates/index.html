<!DOCTYPE html>
<html>
<head>
    <title>Proxy Manager</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-4">
        <h1>Proxy Manager</h1>
        
        <!-- 控制面板 -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">控制中心</h5>
                <div class="row">
                    <div class="col-md-4">
                        <button id="fetchBtn" class="btn btn-primary">获取新代理</button>
                    </div>
                    <div class="col-md-4">
                        <button id="startServerBtn" class="btn btn-success">启动代理服务</button>
                    </div>
                    <div class="col-md-4">
                        <button id="stopServerBtn" class="btn btn-danger">停止代理服务</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 代理列表 -->
        <div class="card mb-4">
            <div class="card-body">
                <h5 class="card-title">代理列表</h5>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>地址</th>
                                <th>协议</th>
                                <th>位置</th>
                                <th>延迟</th>
                                <th>状态</th>
                                <th>操作</th>
                            </tr>
                        </thead>
                        <tbody id="proxyTableBody">
                            <!-- 代理数据将通过JS动态加载 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 日志区域 -->
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">日志</h5>
                <div id="logs" class="pre-scrollable" style="max-height: 300px;"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/jquery.min.js"></script>
    <script>
        // 定期刷新代理列表
        setInterval(() => {
            $.get('/api/proxies', (data) => {
                // 更新代理表格
                let html = '';
                data.proxies.forEach(proxy => {
                    html += `
                    <tr>
                        <td>${proxy.proxy}</td>
                        <td>${proxy.protocol}</td>
                        <td>${proxy.location || 'Unknown'}</td>
                        <td>${proxy.latency ? (proxy.latency * 1000).toFixed(2) + 'ms' : '-'}</td>
                        <td><span class="badge bg-${proxy.status === 'Working' ? 'success' : 'danger'}">${proxy.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-info set-current" data-proxy="${proxy.proxy}">设为当前</button>
                        </td>
                    </tr>`;
                });
                $('#proxyTableBody').html(html);
            });
        }, 3000);

        // 定期刷新日志
        setInterval(() => {
            $.get('/api/logs', (data) => {
                let logsHtml = '';
                data.logs.forEach(log => {
                    logsHtml += `<div>${log}</div>`;
                });
                $('#logs').html(logsHtml);
            });
        }, 2000);

        // 事件监听
        $('#fetchBtn').click(() => {
            $.post('/api/fetch_proxies', () => {
                alert('开始获取代理');
            });
        });

        $('#startServerBtn').click(() => {
            $.post('/api/start_server', {http_port: 8080, socks5_port: 1080}, (data) => {
                alert(data.message);
            });
        });

        $('#stopServerBtn').click(() => {
            $.post('/api/stop_server', (data) => {
                alert(data.message);
            });
        });

        $(document).on('click', '.set-current', function() {
            const proxy = $(this).data('proxy');
            $.post('/api/set_current', {proxy: proxy}, (data) => {
                alert(data.message);
            });
        });
    </script>
</body>
</html>
